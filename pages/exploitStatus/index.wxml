<import src="../../components/we-cropper/we-cropper" />

<view class="container">
  <view class="main_top">
    <view class="status_info">
      <view class="info">
        <view class="image1">
          <image src="{{obj.style_pic_url}}" mode="widthFix" />
        </view>
        <view class="con">
          <view class="name">{{obj.stylename}}</view>
          <view>款号: {{obj.styleno}}</view>
          <view>品类: {{obj.style_type}}</view>
          <view>年份: {{obj.year}}</view>
          <view>季节: {{obj.season}}</view>
          <view>设计师: {{obj.user_name}}</view>
        </view>
      </view>
      <view class="edit">
        <view class="bianji" bindtap='go_edit' wx:if='{{style_edit||style_del}}'>
          <image src="../../static/bianji.svg" />
        </view>
        <view class="view_log" bindtap='view_log'>查看日志</view>
        <view class="view_log" wx:if="{{obj.file == 0}}" bindtap='handle_filing'>存档</view>
        <view class="view_log" wx:if="{{obj.file == 1}}">已存档</view>
      </view>
    </view>
    <scroll-view scroll-x="true" class="nav" scroll-left="{{navScrollLeft}}" scroll-with-animation="{{true}}">
      <block wx:for="{{navData}}" wx:for-index="idx" wx:for-item="navItem" wx:key="idx">
        <view class="nav_item {{currentTab == idx ?'active':''}}" data-current="{{idx}}" bindtap="switchNav">
          {{navItem.text}}</view>
      </block>
    </scroll-view>
  </view>
  <view class="main_bom">
    <swiper class="status_item" current="{{currentTab}}" bindchange="switchTab">
      <swiper-item class="tab_content">
        <view wx:if='{{get_style_design}}'>
          <view class="designNote" wx:if='{{DesignNoteActive==false}}'>
            <view class="operation">
              <view class="PATTEN" wx:if="{{obj.pattern_status=='0'}}">
                <picker bindchange="bindUserSelect" value="{{user_name}}" range="{{stylists}}" range-key='name'>
                  <view class="picker">
                    <view class="tabName" wx:if='{{!user_name}}'>{{'推送打版'}}</view>
                    <view class="tabName" wx:if='{{user_name}}'>{{user_name}}</view>
                    <view class="iconfont icon-icon-test3"></view>
                  </view>
                </picker>
              </view>
              <view class="PATTEN" wx:else>已推送打版</view>
              <view class="bianji">
                <icon wx:if='{{obj.is_urgent}}' class="icon-box-img" type="warn" size="30"></icon>
                <icon wx:else bindtap="styleUrgents" class="icon-box-img" type="warn" size="30" color="#C9C9C9"></icon>
              </view>
              <view class="bianji" bindtap="design_apply" wx:if="{{design_status==1||design_status==3}}">
                <image src="../../static/tijian.svg" />
              </view>
              <view class="bianji" bindtap="cancel_design_apply" wx:if="{{design_status==2}}">
                <image src="../../static/tijian_audit.svg" />
              </view>
              <view class="bianji" wx:if="{{design_status==5}}">
                <image src="../../static/tijian_success.svg" />
              </view>
              <view class="bianji" bindtap="design_apply" wx:if="{{design_status==4}}">
                <image src="../../static/tijian_error.svg" />
              </view>
              <view class="bianji" bindtap='handleDesignNoteEdit'>
                <image src="../../static/bianji.svg" />
              </view>
            </view>
            <view class="DesignNoteInfo">
              <view class="characterInfo">
                <view style="padding: 40rpx;">{{obj.designidea}}</view>
              </view>
              <view class="imgInfo">
                <view wx:for='{{obj.designidea_pic_data}}' wx:key='id'>
                  <image src="{{item.designidea_pic_url}}" mode='widthFix' />
                </view>
              </view>
            </view>
          </view>
          <view class="designNotes" wx:if='{{DesignNoteActive==true}}'>
            <view class="DesignNoteEdit">
              <view class="title">图纸</view>
              <view class="upload_img">
                <view class="img" wx:for='{{imgs}}' wx:key='id'>
                  <image src="{{item.url}}" mode="aspectFill">
                    <icon type='cancel' data-id="{{item.id}}" catchtap="deleteImg"></icon>
                  </image>
                </view>
                <view class="upload" bindtap='get_design_image'>
                  <image src="../../static/upload.svg" style="width: 60rpx;height: 60rpx;" />
                  <view>上传图片</view>
                </view>
              </view>
              <button class="upload-img-btn" bindtap="handleDesignNoteInfo" type='primary'>保存</button>
            </view>
          </view>
        </view>
      </swiper-item>
      <swiper-item class="tab_content">
        <view wx:if='{{materialProcesss}}'>
          <view class="Material_process">
            <view class="add_color" wx:if='{{project_style_color_add}}'>
              <picker mode="multiSelector" bindchange="bindColorPickerChange"
                bindcolumnchange="bindColorPickerColumnChange" value="{{colorIndex}}" range="{{colorList}}"
                data-index="{{index}}">
                <view class="picker">添加颜色</view>
              </picker>
            </view>
            <view class="color_card" wx:for='{{obj.style_color_data}}' wx:key='id'>
              <view wx:if='{{get_style_materials_list}}' class="color" bindtap='get_color_name'
                data-name="{{item.style_color_name}}">
                <view>{{item.style_color_name}}</view>
                <view wx:if='{{project_style_color_del}}' catchtap='color_close' data-item="{{item}}"
                  class="iconfont icon-close"></view>
              </view>
              <view class="card_list" wx:if='{{get_style_materials_list}}'>
                <view wx:for='{{card}}' wx:key='id' wx:for-item='item1' wx:for-index='index1'>
                  <view wx:for='{{item1.style_materials_data}}' wx:key='id' wx:for-item='item2' wx:for-index='index2'>
                    <view class="card card_active" wx:if='{{item.style_color_name==item2.style_color_name}}'>
                      <view class="card_left">
                        <view class="img">
                          <image class="" src="{{item2.picurl}}" mode='aspectFill' />
                          <view>{{ item2.materials_mainclass_name_id }}</view>
                        </view>
                        <view class="con">
                          <view class="name">{{item2.materials_data.materialsname|| "已删除"}}</view>
                          <view>内部编号: {{item2.materials_data.materialsno}}</view>
                          <view>{{item2.style_materials_supplier_data[0].companyname}}</view>
                          <view>{{item2.materials_mainclass_name}} ({{item2.materials_class_name}})</view>
                        </view>
                      </view>
                      <view class="card_right" wx:if='{{project_style_materials_del}}'>
                        <picker bindchange="bindColorSelect" value="{{color}}" range="{{item2.materials_color_data}}"
                          range-key='color' data-item2="{{item2}}">
                          <view class="picker">
                            <view class="con">
                              <view>
                                <view>{{item2.color}}</view>
                                <view>{{item2.color_no}}</view>
                              </view>
                            </view>
                          </view>
                        </picker>
                        <checkbox-group bindchange='handleCheck' data-id="{{item2.id}}">
                          <checkbox class="assist_list" checked="{{item2.isCheck}}"></checkbox>
                        </checkbox-group>
                      </view>
                      <view class="card_del">
                        <view class="iconfont icon-close" bindtap='handle_close_card' data-id="{{item2.id}}"></view>
                      </view>
                    </view>
                  </view>
                </view>
                <view class="add_Material_process"
                  wx:if='{{item.style_color_name==color_name&&project_style_materials_add}}'>
                  <picker bindchange="bindMaterialsSelect" value="{{materials}}" range="{{cardList}}"
                    range-key='materialsCard' data-name="{{item.style_color_name}}">
                    <view class="picker">增加物料工艺卡</view>
                  </picker>
                </view>
              </view>
            </view>
            <view class="operation">
              <checkbox-group bindchange='handleAllCheck' class="checkbox" wx:if='{{card_length>0}}'>
                <checkbox class="assist_list" checked="{{allCheck}}"></checkbox>
                <view>全选</view>
              </checkbox-group>
              <button wx:if="{{style_purchase_add}}" size="mini" type='default' plain
                bindtap='purchaseOrder'>生成采购单</button>
              <button size="mini" type='default' plain wx:if="{{obj.materials_status == 2}}">采购单审核中</button>
            </view>
            <view class="del_card">
              <view class="title">删除历史</view>
              <view class="card_list">
                <view wx:for='{{delListData.style_materials_data}}' wx:key='id'>
                  <view class="card">
                    <view class="card_left">
                      <view class="img">
                        <image class="" src="{{item.picurl}}" mode='aspectFill' />
                      </view>
                      <view class="con">
                        <view class="name">{{item.materials_data.materialsname|| "已删除"}}</view>
                        <view>内部编号: {{item.materials_data.materialsno}}</view>
                        <view>
                          {{item.style_materials_supplier_data[0].companyname}}</view>
                        <view>{{item.materials_mainclass_name}} ({{item.materials_class_name}})</view>
                      </view>
                    </view>
                    <view class="card_right">
                      <view class="picker">
                        <view class="con">
                          <view>
                            <view>{{item.color}}</view>
                            <view>{{item.color_no}}</view>
                          </view>
                        </view>
                      </view>
                    </view>
                    <view wx:if='{{project_style_materials_hfdel}}' class="card_del" bindtap='restore'
                      data-id="{{item.id}}">
                      <view class="iconfont icon-icon-test3"></view>
                    </view>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </swiper-item>
      <swiper-item class="tab_content">
        <view wx:if='{{materialPurchasings}}'>
          <view class="materialPurchasing" wx:if='{{get_style_purchase}}'>
            <view class="tab_list" wx:for='{{materials_procure_list}}' wx:key='id'>
              <view class="list" wx:for='{{item.style_materials_data}}' wx:for-item='item1' wx:for-index='index1'
                wx:key='id'>
                <view class="list_left">
                  <view class="img">
                    <image src="{{item1.picurl}}" />
                    <view>{{ item1.materials_mainclass_name_id }}</view>
                  </view>
                  <view class="con">
                    <view>{{item1.materials_data.materialsname|| "已删除"}}</view>
                    <view>内部编号: {{item1.materials_data.materialsno}}</view>
                    <view>{{item1.style_materials_supplier_data[0].companyname}}</view>
                    <view>{{item1.materials_mainclass_name}} ({{item1.materials_class_name}})</view>
                  </view>
                </view>
                <view class="list_right">
                  <view class="iconfont icon-close" wx:if='{{style_purchase_del}}' bindtap='handleStyleMaterialsDel'
                    data-item="{{item1}}"></view>
                  <view>
                    <view>{{item1.color}}</view>
                    <view>{{item1.color_no}}</view>
                  </view>
                </view>
                <view class="list_operation">
                  <view wx:if='{{purchase_edit && item1.state==0}}' bindtap='Purchasing_entry' data-item="{{item1}}">
                    采购录入</view>
                  <view wx:if='{{style_purchase_log_add && item1.state>0}}' bindtap='go_lining_status'
                    data-item1="{{item1}}">面料状态</view>
                  <!-- <view wx:if='{{item1.state == 4}}' bindtap='go_lining_statuss' data-item1="{{item1}}">查看日志</view> -->
                </view>
              </view>
            </view>
          </view>
        </view>
      </swiper-item>
      <swiper-item class="tab_content">
        <view wx:if='{{patternStatus}}'>
          功能待开发
        </view>
      </swiper-item>
      <swiper-item class="tab_content">
        <view wx:if='{{sampleDress}}'>
          <view class="sampleDress">
            <view class="DesignNoteEdit">
              <view class="title">样衣照片</view>
              <view class="upload_img">
                <view class="img" wx:for='{{img_list}}' wx:key='id'>
                  <image src="{{item.url}}" mode="aspectFill">

                    <icon type='cancel' data-id="{{item.id}}" catchtap="sampleDeleteImg"></icon>
                  </image>
                </view>
                <view class="upload" bindtap='get_color_image' wx:if='{{style_sample_add}}'>
                  <image src="../../static/upload.svg" style="width: 60rpx;height: 60rpx;" />
                  <view>上传样衣图片</view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </swiper-item>
    </swiper>
  </view>
</view>

<view class="we_cropper" wx:if='{{we_cropper_active}}'>
  <view class="imgDisposeBlock">
    <view class='imgDisposeArea'>
      <template is="we-cropper" data="{{...cropperOpt}}" />
    </view>
    <view class='imgDisposeControlLine'>
      <view class='editBtn closeBtn' bindtap="closeTap">取消</view>
      <view class='editBtn editPerfectBtn' bindtap="getCropperImage">上传</view>
    </view>
  </view>
</view>